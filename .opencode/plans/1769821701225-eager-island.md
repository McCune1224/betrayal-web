# Plan: Update Documentation for Svelte 5 Runes Compliance

## Overview

This plan addresses the Svelte 5 runes issues discovered during frontend debugging and establishes preventive measures through documentation updates only.

## Scope

**IN SCOPE:**
- Update AGENTS.md with Svelte 5 runes best practices
- Update sveltekit-ui-patterns skill with comprehensive runes documentation
- Expand sveltekit-test-playbook skill (basic guidance, no test implementation)

**OUT OF SCOPE:**
- No frontend testing frameworks
- No CI/CD changes
- No test file creation

## Issues Found and Fixed

1. **File Extension Issue**: `stores.ts` used `$state` runes but wasn't named `stores.svelte.ts`
2. **Export Restriction**: Tried to export `$derived` value directly from module (not allowed)

## Changes to Make

### 1. Update AGENTS.md

**File**: `/home/mckusa/Code/betrayal-web/AGENTS.md`

**Add new section: "Svelte 5 Runes Best Practices"**

Content to include:
- Files using `$state`, `$derived`, `$effect`, etc. MUST use `.svelte.ts` extension
- Cannot export `$derived` values directly - use getter functions
- Cannot export `$state` primitives that get reassigned - use objects or getter functions
- Always run `bun run check` before committing frontend changes
- Reference to official Svelte docs and internal skills

### 2. Update sveltekit-ui-patterns Skill

**File**: `/home/mckusa/Code/betrayal-web/.opencode/skills/sveltekit-ui-patterns/SKILL.md`

**Current state**: Very minimal (20 lines)

**Expand to include:**
- Svelte 5 runes overview
- File naming conventions (`.svelte.ts` vs `.ts`)
- State sharing patterns between modules
- Common pitfalls and solutions
- Code examples with ✅ and ❌ markers
- Quick reference card for runes restrictions

### 3. Expand sveltekit-test-playbook Skill

**File**: `/home/mckusa/Code/betrayal-web/.opencode/skills/sveltekit-test-playbook/SKILL.md`

**Keep minimal** but add note about manual testing procedures:
- How to manually test Svelte 5 components
- Common issues to watch for when testing runes-based code
- Quick checklist for testing stores

## Critical Rules to Document

Based on official Svelte documentation (from Context7):

1. **File Extensions**: Files using runes must be `.svelte.js` or `.svelte.ts`

2. **Export Restrictions**: 
   - ❌ Cannot export `$derived` values
   - ❌ Cannot export `$state` primitives that get reassigned
   - ✅ CAN export `$state` objects (mutate properties)
   - ✅ CAN export getter functions

3. **Why**: Svelte compiler transforms `$state` references one file at a time

## Files to Modify

1. `/home/mckusa/Code/betrayal-web/AGENTS.md` - Add Svelte 5 section
2. `/home/mckusa/Code/betrayal-web/.opencode/skills/sveltekit-ui-patterns/SKILL.md` - Expand with runes docs
3. `/home/mckusa/Code/betrayal-web/.opencode/skills/sveltekit-test-playbook/SKILL.md` - Add manual testing notes

## Success Criteria

- [ ] AGENTS.md contains clear Svelte 5 runes guidelines
- [ ] sveltekit-ui-patterns skill provides comprehensive runes documentation
- [ ] sveltekit-test-playbook skill has basic testing guidance
- [ ] Code examples show correct patterns
- [ ] Documentation references official Svelte docs

## Estimated Effort

- Documentation updates: 2-3 hours
- **Total: 2-3 hours**